\documentclass[final]{siamltex}

% for red MarginPars
\usepackage{color}

% for \boldsymbol
\usepackage{amsmath}

% for \mathfrak
\usepackage{amsfonts}

% total number of floats allowed on a page
\setcounter{totalnumber}{100}

% float page fractions
\renewcommand{\topfraction}{0.9}
\renewcommand{\bottomfraction}{0.9}
\renewcommand{\textfraction}{0.2}

% MarginPar
\setlength{\marginparwidth}{0.75in}
\newcommand{\MarginPar}[1]{\marginpar{\vskip-\baselineskip\raggedright\tiny\sffamily\hrule\smallskip{\color{red}#1}\par\smallskip\hrule}}

% for non-stacked fractions
\newcommand{\sfrac}[2]{\mathchoice
  {\kern0em\raise.5ex\hbox{\the\scriptfont0 #1}\kern-.15em/
   \kern-.15em\lower.25ex\hbox{\the\scriptfont0 #2}}
  {\kern0em\raise.5ex\hbox{\the\scriptfont0 #1}\kern-.15em/
   \kern-.15em\lower.25ex\hbox{\the\scriptfont0 #2}}
  {\kern0em\raise.5ex\hbox{\the\scriptscriptfont0 #1}\kern-.2em/
   \kern-.15em\lower.25ex\hbox{\the\scriptscriptfont0 #2}}
  {#1\!/#2}}

\def\1b {{\bf 1}}
\def\bb {{\bf b}}
\def\Fb {{\bf F}}
\def\gb {{\bf g}}
\def\Ib {{\bf I}}
\def\mb {{\bf m}}
\def\Qb {{\bf Q}}
\def\vb {{\bf v}}
\def\wb {{\bf w}}
\def\xb {{\bf x}}

\def\chib   {\boldsymbol{\chi}}
\def\deltab {\boldsymbol{\delta}}
\def\Gammab {\boldsymbol{\Gamma}}
\def\phib   {\boldsymbol{\phi}}
\def\Psib   {\boldsymbol{\Psi}}
\def\Sigmab {\boldsymbol{\Sigma}}
\def\taub   {\boldsymbol{\tau}}
\def\zetab  {\boldsymbol{\zeta}}

\def\Hext {H_{\rm ext}}

\def\half   {\frac{1}{2}}
\def\myhalf {\sfrac{1}{2}}

\begin{document}

%==========================================================================
% Title
%==========================================================================
\title{A Conservative, Thermodynamically Consistent Low Mach Number Hydrodynamics Algorithm}

\author{A. Nonaka\footnotemark[1],
        J. B. Bell\footnotemark[1], and
        A. Donev\footnotemark[2]}

\renewcommand{\thefootnote}{\fnsymbol{footnote}}

\footnotetext[1]{Center for Computational Sciences and Engineering,
                 Lawrence Berkeley National Laboratory, 
                 Berkeley, CA 94720, USA}
\footnotetext[2]{Courant Institute of Mathematical Sciences,
                 New York University,
                 New York, NY 10012, USA}

\maketitle

\begin{abstract}
We present a projection method for modeling unsteady, low Mach number multicomponent
flow.  Due to the linearization of the equation of state used when deriving
constraint manifolds, previously it has
not been possible to simultaneously conserve mass and energy while remaining in 
thermodynamic equilibrium with the spatially-constant ambient pressure.
Our method is fully conservative and introduces a new iterative scheme that 
corrects thermodynamic drift to a desired tolerance.  For confined regions, our
iterative scheme also allows for thermodynamically consistent evolution in the presence
of time-varying ambient pressure.
Our method is suitable for a generlized equation of state, and offers a development
path for low Mach number reacting flow and stochastic flow described by fluctuating
hydrodynamics equations.  We present results for mixtures of noble gases with external
heating.
\end{abstract}

\section{Introduction}
 This work is based low Mach number formulations proposed in
\cite{RehmBaum,MajdaSethian}, but here our equation set is suitable for a
generalized equation of state, is fully conservative, and includes an iterative
scheme to correct thermodynamic drift.
The basic model is a system of advection-diffusion equations
subject to a constraint on the velocity field that arises by differentiating
the equation of state along particle paths under to the assumption
that the thermodynamic pressure remain spatially constant.  Physically, this
manifests itself as an instananeous acoustic equilibration, thus eliminating
pressure waves.  Numerically, this allows for an advective, rather than acoustic,
time step constraint.

Our numerical framework is the staggered grid, finite volume approach first
introduced in \cite{LowMachExplicit,LowMachImplicit,LowMachMulti} for
multicomponent miscible liquids with incompressible components.
We treat the viscosity implicitly without splitting the pressure
update, relying on a recently-developed variable-coefficient multigrid-preconditioned
Stokes solver \cite{StokesPreconditioners}.
For now, mass diffusion in treated explicitly making our
approach suitable for large Schmidt numbers.  Implicit mass diffusion is a subject
of future work.

\section{Equations}
The governing conservation equations for momentum, mass, and energy for our system are:
\begin{eqnarray}
\frac{\partial\rho\vb}{\partial t} &=& - \nabla\cdot(\rho\vb\vb) - \nabla\pi + \nabla\cdot\taub + \rho\gb,\label{eq:momentum}\\
\frac{\partial\rho_i}{\partial t} &=& -\nabla\cdot(\rho_i\vb) + \nabla\cdot \Fb_i,\label{eq:mass}\\
\frac{\partial\rho h}{\partial t} &=& -\nabla\cdot(\rho h\vb) + \frac{DP}{Dt} + \nabla\cdot\Qb + \sum_k \nabla\cdot h_k \Fb_k + \rho\Hext,\label{eq:enthalpy}
\end{eqnarray}
where $\rho$ is the density, $\vb$ is the velocity, $\pi$ is the dynamic 
(or perturbational) pressure, $\gb$ is the gravitational vector, $\rho_i=\rho w_i$ is
the density of fluid component $i$ with $\rho = \sum_i\rho_i$ and $w_i$ the 
concentrations (mass fractions), $P$ is the total
pressure, $h$ is the enthalpy, $h_k = \partial h/\partial w_k$,
$\Hext$ is an external heating term, $\taub$ is the stress tensor,
$\Fb$ are the mass fluxes, and $\Qb$ is the heat flux.
Starting from the fully compressible equations and expanding in Mach number shows 
that the leading order pressure terms in Mach number must be constant in space. 
Thus, the perturbational pressure $\pi$ is $O(M^2)$.
The low Mach number system is then obtained by ignoring the effect of terms of 
order $M^2$ or higher in pressure  on the thermodynamic state of the system.
The equation of state then becomes a constraint on the evolution; namely,
the evolution of the system is constrained so that
\begin{equation}
P_0(t) = P(\rho,\wb,T),\label{eq:EOS}
\end{equation}
where $T=T(\rho,\wb,h)$ is specified by the equation of state.\\

The viscous stress tensor,
$\taub = \eta[\nabla\vb + (\nabla\vb)^T]$,
ignores the effect of bulk viscosity, which can be aborbed into $\pi$.
The heat flux has the form $\Qb = \lambda\nabla T$.
The mass fluxes contains contributions from 
compositional gradients, barodiffusion, and temperature gradients,
\begin{equation}
\Fb = -\rho\Ib\wb\chib\left[\Gammab\nabla\xb + (\phib - \wb)\frac{\nabla P}{n k_B T} + \zetab\frac{\nabla T}{T}\right],
\end{equation}
where $\Ib$ is the identity matrix, $\wb$ is the vector of concentrations,
$\chib$ is the diffusion matrix, $\xb$ are the mole fractions,
$\phib$ are the volume fractions (which for an ideal gas is equivalent to mole fractions),
$k_B$ is Boltzmann's constant,
$T$ is the temperature, and $\zetab$ are thermodiffusion coefficients.  The total
number density is the sum of the partial number densities, $n=\sum_i n_i$ with
$n_i=\rho_i/W_i$ and $W_i$ the molecular mass of species $i$.

Equations (\ref{eq:momentum}), (\ref{eq:mass}), (\ref{eq:enthalpy})
with $DP/Dt$ in the enthalpy equation replaced by $dP_0/dt$, and (\ref{eq:EOS})
form the actual system that we would like to solve.
This corresponds to evolution subject to a constraint.  From the analysis below it 
will become apparent that this system is an index 3 differential algebraic system.
Before looking in detail at the structure of the system, it is, perhaps, helpful to 
consider a physical interpretation of the
system.  The perturbational pressure $\pi$ constrains velocity field so that
the evolution so that the evolution of $h$ and $\rho_k$
preserves a thermodynamic pressure that is a function of $t$ only.
When the system is open, the pressure
equilibrates to the ambient pressure and $P_0$ is independent of time and known.
When the system is closed
$P_0$ represents the global pressure
required force the fluid to occupy the available volume.\\

We also note that $\rho, h, T, P$ are linked by the equation of state in a sense that given
$\wb$ and any two of these variables, the equation of state uniquely specifies the other
two variables.  In particular, we will think of enthalpy as $h = h(P,\wb,T)$ when deriving
the divergence constraint from the equation of state.
We view these relations as defining temperature in terms of enthalpy.

\subsection{Velocity Constraint and Thermodynamic Pressure Update}

Directly attacking the evolution of the constrained system is not tractable.
For DAE's the standard approach to understanding the structure is to differentiate the constraint.
If we start on the constraint and recast the evolution in terms of the derivative of the constraint
being satisfied, the resulting evolution of the system is analytically equivalent.  In the theory
of DAE's the number of times the system needs to be differentiated to recast it as a pure initial
value problem is referred to as the index.
The derivative of the constraint can also be cast as a characterization of the tangent plane to the
constraint manifold but it is not clear what to do with that observation.\\

The key things we want to get a handle on are how the two different elements that go into the
constraint interact to control the evolution and whether they are, in some sense, uniquely specified.\\

We begin by differentiating the 
right-hand side of equation (\ref{eq:EOS}) along particle paths,
\begin{equation}
\frac{DP}{Dt} = P_\rho\frac{D\rho}{Dt} + P_T\frac{DT}{Dt} + \sum_kP_{w_k}\frac{Dw_k}{Dt}.
\end{equation}
$P_0$ is spatially constant
so we can replace $DP/Dt$ 
with $d P_0/ dt$:
\begin{equation}
\frac{d P_0}{dt} = P_\rho\frac{D\rho}{Dt} + P_T\frac{DT}{Dt} + \sum_kP_{w_k}\frac{Dw_k}{Dt}.\label{eq:particle paths}
\end{equation}
As noted above we are also make the
substitution $DP/Dt = d P_0/ d t$ in the enthalpy equation.  (Since we
are currently assuming $P_0$ is constant in space, we are not allowing
for pressure stratification due to gravity.)
Next, by noting that by continuity $D\rho/Dt = -\rho\nabla\cdot\vb$, 
we can rewrite 
(\ref{eq:particle paths}) as
\begin{equation}
\nabla\cdot\vb = \frac{1}{\rho P_\rho}\left(-\frac{dP_o}{dt} + P_T\frac{DT}{Dt} + \sum_kP_{w_k}\frac{Dw_k}{Dt}\right).\label{eq:constraint1}
\end{equation}
To obtain an expression for $DT/Dt$, we differentiate the enthalpy, $h=h(T,P,\wb)$, 
along particle paths and replace $DP/Dt$ with $dP_0/dt$ to obtain
\begin{equation}
\frac{Dh}{Dt} = 
c_p \frac{DT}{Dt} 
+ h_P\frac{d P_0}{d t} + \sum_k h_{k}\frac{Dw_k}{Dt}  \;\;  ,
\end{equation}
where $c_p = \partial h/\partial T$.  This gives
\begin{equation}
\frac{DT}{Dt} = \frac{1}{c_p}\left(\frac{Dh}{Dt} - h_P\frac{d P_0}{d t} - \sum_kh_{k}\frac{Dw_k}{Dt}\right).\label{eq:DTDt1}
\end{equation}
From equation (\ref{eq:mass}) and 
continuity we have,
\begin{equation}
\frac{Dw_k}{Dt} = \frac{1}{\rho}\nabla\cdot\Fb_k,\label{eq:DwDt}
\end{equation}
and from equation (\ref{eq:enthalpy}) we have,
\begin{equation}
\frac{Dh}{Dt} = \frac{1}{\rho}\left(\frac{dP_0}{dt} + \nabla\cdot\Qb + \sum_k\nabla\cdot h_k\Fb_k + \rho\Hext\right).\label{eq:DhDt}
\end{equation}
Combining (\ref{eq:DTDt1}), (\ref{eq:DwDt}), and (\ref{eq:DhDt}) we have
\begin{equation}
\frac{DT}{Dt} = \frac{1}{\rho c_p}\left[\left(1 - \rho h_P\right)\frac{dP_0}{dt} + \nabla\cdot\Qb + \sum_k\nabla\cdot h_k\Fb_k + \rho\Hext - \sum_kh_k\nabla\cdot\Fb_k\right].\label{eq:DTDt}
\end{equation}
Combining equations (\ref{eq:constraint1}) and (\ref{eq:DTDt}) gives
\begin{equation}
\nabla\cdot\vb + \alpha\frac{dP_0}{dt} = \sum_k \beta_k \nabla\cdot\Fb_k + \theta\left(\nabla\cdot\Qb + \sum_k\nabla\cdot h_k\Fb_k + \rho\Hext\right) \equiv S,\label{eq:constraint}
\end{equation}
\begin{equation}
\alpha = -\frac{1}{\rho^2 P_\rho}\left[\frac{(1-\rho h_p)P_T - \rho c_p}{c_p}\right], \quad
\beta_k = \frac{P_{w_k}}{\rho^2 P_\rho} - \frac{h_k P_T}{\rho^2 c_p P_\rho}, \quad
\theta = \frac{1}{\rho^2 P_\rho}\frac{P_T}{c_P}.\label{eq:thermo deriv}
\end{equation}

\subsection{Ideal Gas Equation of State}
An ideal multi-component gas has an equation of state,
\begin{equation}
P = \rho\mathcal{R}T\sum_k\frac{w_k}{m_k},
\end{equation}
with universal gas constant $\mathcal{R} = 8.31451\times 10^7$ [erg/(K-mol)] 
(all units are CGS) and $m_k$ is the molecular mass of species $k$ in [g/mol].
The enthalpy, mass fractions, and temperature are related by:
\begin{equation}
h = \sum_k w_k h_k(T).
\end{equation}
For an ideal gas, the thermodynamic derivatives in (\ref{eq:thermo deriv})
reduce to,
\begin{eqnarray}
P_\rho = \mathcal{R} T\sum_k\frac{w_k}{m_k}, \quad
P_T = \rho\mathcal{R}\sum_k\frac{w_k}{m_k}, \quad
P_{w_k} = \frac{\rho\mathcal{R}T}{m_k},
\end{eqnarray}
and simply the coefficients in the constraint equation,
\begin{equation}
\beta_k = \frac{1}{\rho}\left(\frac{\bar{m}}{m_k} - \frac{h_m}{c_p T}\right), \quad
\theta = \frac{1}{\rho c_p T},
\end{equation}
where $\bar{m} = (\sum_k w_k/m_k)^{-1}$ is the mixture-averaged (mean) molecular mass.
In \cite{MAESTROI}, it was shown that
\begin{equation}
\alpha = \frac{1}{\Gamma_1 P},
\end{equation}
where $\Gamma_1 = \left(d\ln{p}/d\ln{\rho}\right)_{\rm ad}$ is the first adiabatic exponent
at constant entropy and composition.  Note that in general, $\Gamma_1 P/\rho = c^2$ and
therefore $\alpha = 1/(\rho c^2)$.
Note that for an ideal gas, $\Gamma_1 = \gamma = c_p/c_v$.

\subsection{Comparison to LMC and MAESTRO}
It is worth comparing this formulation to other low Mach number constraints.
This model is equivalent to equation (7) in \cite{DayBell:2000},
but with three exceptions.  First,
we are not accounting for reactions, so $\dot\omega=0$.  Second, here we have 
{\it not} made the substitution, 
$\nabla\cdot h_k\Fb_k - h_k\nabla\cdot\Fb_k = \Fb\cdot\nabla h_k$, so the coefficients
$\beta_k$ and $\theta$ are slightly different (although the overall expression is
analytically equivalent).  Third, the time-derivative of $P_0$ is no longer zero,
so we gain an additional term.  Notably, the coefficient in front of the pressure 
derivative matches that in the MAESTRO algorithm \cite{MAESTROIII},
except that paper includes a convective derivative of $P_0$ due to stratification.

\subsection{Confined Domains}
The unknowns in equation (\ref{eq:constraint}) are $\vb$ and $d P_0/d t$.
For open domains where $\vb$ is allowed to be non-zero on one or more walls $P_0$
is constant and the constraint equation reduces to
\begin{equation}
\nabla\cdot\vb = S.
\end{equation}
This is a generalization of standard low Mach number approaches (at least our version) 
and fits into
a framework we have dealt with before.\\

For confined domains with no-flow walls the constraint is somewhat more complex.
Equation (\ref{eq:constraint}) then represents the derivative of the original
constraint.  We now want to see how
decomposition of this equation into mean and fluctuating (not in the stochastic sense)
components allows us to recover the evolution of $P_0$ and $\pi$.\\

For a closed system, $\nabla \cdot \vb = g$ only has a solution if $\int_\Omega g~d\Omega = 0$
We can use this fact to simultaneously solve for the unknowns
$\vb$ and $dP_0/dt$.
To do this, we split up $S$ into an average and a perturbational component,
\begin{equation}
S = \bar{S} + \delta S.
\end{equation}
We also
split $\alpha$ into an average and a perturbational component,
\begin{equation}
\alpha = \bar{\alpha} + \delta\alpha.
\end{equation}
By definition,
\begin{equation}
\int_{\Omega} \delta S ~\partial\Omega = \int_{\Omega} \delta \alpha ~\partial\Omega = 0.\label{eq:zero int}
\end{equation}
So equation (\ref{eq:constraint}) can be rewritten as,
\begin{equation}
\nabla\cdot\vb + \bar{\alpha}\frac{d P_0}{d t} 
= \bar{S} + \delta S -
\delta\alpha\frac{d P_0}{d t}.\label{eq:constraint2}
\end{equation}
Since $\nabla \cdot \vb$ must integrate to zero and $P_0$ must be only a function of time,
equation (\ref{eq:constraint2}) can be uniquely decomposed to give
\begin{equation}
\frac{dP_0}{dt} = \frac{\bar{S}}{\bar{\alpha}}.\label{eq:P0}
\end{equation}
and
\begin{eqnarray}
\nabla\cdot\vb &=& \delta S - \delta\alpha\frac{dP_0}{dt} \nonumber\\
&=& \delta S - \delta\alpha\frac{\bar{S}}{\bar{\alpha}}.\label{eq:constraint3}
\end{eqnarray}
Thus, the original system is analytically equivalent to solving the system (\ref{eq:momentum}), (\ref{eq:mass}), and (\ref{eq:enthalpy})
subject to (\ref{eq:P0}) and (\ref{eq:constraint3}).

\section{Overview of Time Stepping Strategy}

The form of the system given above can fit into the framework of low Mach number algorithms we have
developed based on the generalized Stokes solver. 
The additional issue that arises is that since the core numerical algorithm is based on the derivative
of the constraint, we can numerically drift off of the actual algebraic constraint. Thus, we augment the
basic algorithm with iterative 
``volume discrepancy'' scheme described below to solve 
(\ref{eq:momentum}), (\ref{eq:mass}), and (\ref{eq:enthalpy})
while enforcing condition (\ref{eq:EOS}) to a specified tolerance.\\

At the most basic level, the time-stepping strategy looks like this:\\
\begin{itemize}
\item {\bf Step 1}


\item {\bf Step A}: Advance $P_0$ with equation (\ref{eq:P0}) and 
then solve for velocity using the Stokes system GMRES solver coupling equations 
(\ref{eq:momentum}) and (\ref{eq:constraint3}).\\
\item {\bf Step B}: Update thermodynamic variables using equations (\ref{eq:mass}), 
and (\ref{eq:enthalpy}).  This involves the explicit computation of advective fluxes,
explicit computation of mass diffusion, and implicit treatment of heat fluxes.\\
\item {\bf Step C}: Check to see how the updated $P(\rho,\wb,T)$ compares to the 
updated $P_0$.  If the drift 
is unacceptable, add a correction to the right-hand-side of equations
(\ref{eq:P0}) and (\ref{eq:constraint3})
designed to drive the thermodynamic variables into equilibrium with 
$P_0$ and then return to {\bf Step A}.  Details on the form of this 
correction are given below.\\
\end{itemize}
The actual time-advancement algorithm will be a bit more complicated, as we 
incorporate a predictor-corrector formulism to obtain second-order advective 
fluxes, and also incorporate an iterative scheme for heat fluxes, etc.

\section{Equation of State Drift}
Recall equation (\ref{eq:particle paths}), where we analytically enforce that
thermodynamic pressure will evolve to be consistent with the evolution of $P_0$:
\begin{equation}
\frac{dP_0}{dt} = P_\rho\frac{D\rho}{Dt} + P_T\frac{DT}{Dt} + \sum_kP_{w_k}\frac{Dw_k}{Dt}.
\end{equation}
This equation was shown to be analytically equivalent to equation (\ref{eq:constraint}):
\begin{equation}
\nabla\cdot\vb + \alpha\frac{dP_0}{dt} = S.
\end{equation}

This divergence constraint represents a linearized approximation for the velocity 
field required to ensure that the thermodynamic variables remain thermodnamically
consistent with $P_0$.  Since in general the EOS is non-linear, the updated 
thermodynamic variables will not
satisfy this condition.  We propose an iterative strategy based on
volume discrepancy schemes used
in other conservative, finite-volume low Mach number algorithms
\cite{Pember:1998,XRB}, that
uses a modified divergence constraint designed to drive the updated 
thermodynamic variables closer to thermodynamic equilibrium with $P_0$ with each iteration.
For confined domains, we also iteratively update $P_0$ as well.  To our knowledge,
such approaches have only been used for open domains.\\

After computing a velocity field with the GMRES solver, and updating the thermodynamic
variables with advective and diffusive fluxes, the EOS will no longer be satisfied.
The amount by which the EOS is not satisfied can be easily quantified by defining
the drift, $\Delta P = P_{\rm EOS}^{n+1} - P_0^{n+1}$ with $P_{\rm EOS} = P(\rho,\wb,T)$.\\

If we were able to ``redo'' the velocity computation, the rate at which we want the 
pressure to change in each cell is no longer given
by simply $dP_0/dt$, but is now given by:
\begin{equation}
\frac{DP}{Dt} = \frac{dP_0}{dt} - \frac{\Delta P}{\Delta t}.
\end{equation}
We include the $\Delta p/\Delta t$ ``volume discrepancy'' correction term here because 
now we have a sense for what the numerics does to the local thermodynamic pressure in 
each cell without such a correction.  Physically, by including this term, we are enforce 
an additional amount of expansion or contraction within each cell in order to modify 
the pressure.  Now, equation (\ref{eq:constraint}) is replaced by
\begin{equation}
\nabla\cdot\vb + \alpha\left(\frac{dP_0}{dt} - \frac{\Delta P}{\Delta t}\right) = S.
\end{equation}
or
\begin{equation}
\nabla\cdot\vb + \alpha\frac{dP_0}{dt} = S + \underbrace{\alpha\frac{\Delta P}{\Delta t}}_{S_{\rm corr}}.
\end{equation}
Similar to above, in order for this sytem to be solvable we split the update into a
equations for $P_0$ and $\vb$,
\begin{equation}
\frac{dP_0}{dt} = \frac{\bar{S} + \bar{S}_{\rm corr}}{\bar{\alpha}}
\end{equation}
\begin{equation}
\nabla\cdot\vb = \delta S + \delta S_{\rm corr} - \delta\alpha\left(\frac{\bar{S} + \bar{S}_{\rm corr}}{\bar{\alpha}}\right).
\end{equation}
As we iterate, we increment (rather than reset) $\delta S_{\rm corr}$ based on how much 
the current solution drifts using $\delta S_{\rm corr}$ the previous iteration.

\section{Heat Flux Integration Strategy}
Recall the form of the enthalpy equation we are interested in:
\begin{equation}
\frac{\partial(\rho h)}{\partial t} = -\nabla\cdot(\rho h\vb) + \frac{dP_0}{dt} + \nabla\cdot\lambda\nabla T + \sum_k\nabla\cdot h_k\Fb_k + \rho\Hext.
\end{equation}
In our time-advancement scheme, we want to handle the thermal diffusion semi-implicitly.
The details are given in Section {\ref{Sec:Time-Advancement Strategy}} but for ease
of exposition we outline the heat flux strategy here.
We use an iterative method that
linearizes the relationship between how $h$ changes with respect to changes in $T$.
Note that we have already updated the densities, but unfortunately the time-advanced
mass fluxes also depend on the enthalpy.  In the full time-advancement algorithm,
the idea shall be to iterate these fluxes as well, with an initial guess coming from
an earlier step in the algorithm.  The notation here is just used to give a general
idea of the iterative scheme.  Also, the details of the treatment for 
$dP_0/dt$ will be given below.\\ \\
Let's assume we want to form an iterative update to $h$ using
\begin{eqnarray}
\frac{\rho^{n+1}h^{n+1,l+1} - (\rho h)^n}{\Delta t} &=& -\nabla\cdot(\rho h\vb) + \frac{dP_0}{dt}\nonumber\\
&&+ \half\nabla\cdot\lambda^n\nabla T^n + \half\nabla\cdot\lambda^{n+1,l}\nabla T^{n+1,l+1}\nonumber\\
&& + \half\sum_k\nabla\cdot h_k^n \Fb_k^n + \half\sum_k\nabla\cdot h_k^{n+1,l}\Fb_k^{n+1,l}\nonumber\\
&& + \half(\rho\Hext)^n + \half(\rho\Hext)^{n+1,l}.\label{eq:temp form}
\end{eqnarray}
\\
We start with initial guesses $(T,h)^{n+1,l=1} = (T,h)^n$.\\ \\
We say that
\begin{equation}
T^{n+1,l+1} = T^{n+1,l} + \delta T\label{eq:delta T}
\end{equation}
Linearization gives
\begin{equation}
h^{n+1,l+1} = h^{n+1,l} + c_p^{n+1,l}\delta T\label{eq:delta h}
\end{equation}
Substituting (\ref{eq:delta T}) and (\ref{eq:delta h}) into (\ref{eq:temp form}) gives:
\begin{eqnarray}
\frac{\rho^{n+1}(h^{n+1,l} + c_p^{n+1,l}\delta T) - (\rho h)^n}{\Delta t} &=& -\nabla\cdot(\rho h\vb) + \frac{dP_0}{dt}\nonumber\\
&&\hspace{-0.5in}+ \half\nabla\cdot\lambda^n\nabla T^n + \half\nabla\cdot\lambda^{n+1,l}\nabla(T^{n+1,l} + \delta T)\nonumber\\
&&\hspace{-0.5in} + \half\sum_k\nabla\cdot h_k^n \Fb_k^n + \half\sum_k\nabla\cdot h_k^{n+1,l} \Fb_k^{n+1,l}\nonumber\\
&&\hspace{-0.5in} + \half(\rho\Hext)^n + \half(\rho\Hext)^{n+1,l}.
\end{eqnarray}
We solve this implicitly for $\delta T$, then compute $T^{n+1,l+1}$
using (\ref{eq:delta T}) and compute $h^{n+1,l+1}$ using the EOS.

\section{Time-Advancement Strategy}\label{Sec:Time-Advancement Strategy}
The full time-advancement strategy is divided into two major steps, the Scalar Predcitor
and the Scalar Corrector.\\ \\
{\bf Step 1: Scalar Predictor.}\\ \\
The goal of the Scalar Predictor is to compute a velocity field at $t^n$, $\vb^n$,
as well as preliminary time-advanced thermodynamic variables and pressure,
$(\rho_i,\rho h)^{*,n+1}$ and $P_0^{*,n+1}$.  The advective fluxes will be computed
with $\vb^n$ and thus the Scalar Predictor is formally first-order in time.
In the Scalar Corrector, we increase the order of accuracy by using a trapezoidal
rule discretization of the advective fluxes.\\

At the beginning of the Scalar Predictor, we know the thermodynamic variables and 
velocity from the previous time step, $(\rho_i,\rho h)^{n-1}$ and $\vb^{n-1}$, the 
thermodynamic variables at the beginning of the time step, $(\rho_i,\rho h)^n$, the
thermodynamic pressure at the beginning of the time step, $P_0^n$, and a preliminary
guess of the velocity at the beginning of the time step, $\vb^{*,n}$.  These quantities
are all available after completing the Scalar Corrector from the previous time step.\\

The constraint equation will be iteratively modified using a volume discrepancy
correction in order to adjust the velocity field
so that $(\rho_i,\rho h,P_0)$ evolve in a thermodynamically consistent manner.\\

To begin, we compute $S^n = S(\rho,\wb,T)^n$ and $\alpha^n = \alpha(\wb,T,P_0)^n$
into average and perturbational components.
We set the initial volume discrepancy correction to zero, 
$S_{\rm corr}^n = 0$, as well as the individual terms in the decomposition,
$S_{\rm corr}^n = \bar{S}_{\rm corr}^n + \delta S_{\rm corr}^n$.
We loop over the following until the convergence criteria in {\bf Step 1e} is met:\\
\begin{itemize}
\item {\bf Step 1a:} Compute a pressure update:
\begin{equation}
P_0^{*,n+1} = P_0^n + \Delta t\left(\frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n}\right)
\end{equation}
\item {\bf Step 1b:} Compute the velocity, $\vb^n$, and dynamic pressure, $\pi^n$,
using a GMRES solver for the Stokes system:
\begin{eqnarray}
\frac{\rho^n\vb^n - \rho^{n-1}\vb^{n-1}}{\Delta t} + \nabla\pi^n &=& -\half\nabla\cdot\left[(\rho\vb\vb)^{n-1} + (\rho\vb\vb)^{*,n}\right]\nonumber\\
&& + \frac{1}{2}\nabla\cdot(\taub^{n-1} + \taub^n) + \frac{1}{2}(\rho^{n-1} + \rho^n)\gb,\label{eq:Stokes}
\end{eqnarray}
\begin{equation}
\nabla\cdot\vb^n = \delta S^n + \delta S_{\rm corr}^n - \delta\alpha^n\left(\frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n}\right).
\end{equation}
If we express the viscous stress tensor in operator form, e.g., 
$\mathcal{A}_0^n\vb = \nabla\cdot[\eta^n(\nabla\vb + (\nabla\vb)^T)]$. , then (\ref{eq:Stokes}) can be 
expressed in a familiar Stokes operator form,
\begin{eqnarray}
\left(\frac{\rho^n}{\Delta t} - \half\mathcal{A}_0^n\right)\vb^n + \nabla\pi^n &=& \frac{\rho^{n-1}\vb^{n-1}}{\Delta t} - \half\nabla\cdot\left[(\rho\vb\vb)^{n-1} + (\rho\vb\vb)^{*,n}\right]\nonumber\\
&& + \half\mathcal{A}_0^{n-1}\vb^{n-1} + \half(\rho^{n-1} + \rho^n)\gb.
\end{eqnarray}
\MarginPar{These notes about solving in homogeneous delta form don't really have to make it into the paper.
They are more to help me with implementation.
We could mention that we do it, and just cite the binary paper.}
In practice, we solve for a modified increment to the velocity field, $\deltab\vb$.  In particular,
we split the updated velocity into
$\vb^n = \bar{\vb}^{n-1} + \deltab\vb$, where $\bar{\vb}^{n-1}$ is the velocity at $t^{n-1}$, but with modified boundary
conditions consistent with $\vb^n$, and $\deltab\vb$ has homogeneous boundary conditions of the same type (Dirichlet or Neumann).
We also split $\pi^n = \pi^{n-1} + \delta\pi$ in the same way.  Rewriting the Stokes system above we have:
\begin{eqnarray}
\left(\frac{\rho^n}{\Delta t} - \half\mathcal{A}_0^n\right)\deltab\vb + \nabla\delta\pi &=& \frac{\rho^{n-1}\vb^{n-1} - \rho^n\bar{\vb}^{n-1}}{\Delta t} - \nabla\pi^{n-1}\nonumber\\
&&\hspace{-1.5in} - \half\left[\nabla\cdot(\rho\vb\vb)^{n-1} + \nabla\cdot(\rho\vb\vb)^{*,n}\right] + \half(\mathcal{A}_0^{n-1}\vb^{n-1}+\mathcal{A}_0^n\bar{\vb}^{n-1}) + \half(\rho^{n-1} + \rho^n)\gb,\nonumber\\
\end{eqnarray}
\begin{equation}
-\nabla\cdot\delta\vb = \nabla\cdot\bar{\vb}^{n-1} - \left[\delta S^n + \delta S_{\rm corr}^n - \delta\alpha^n\left(\frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n}\right)\right].
\end{equation}
\item {\bf Step 1c:} Compute preliminary, time-advanced densities using forward-Euler advective fluxes
and explicit mass diffusion:
\begin{equation}
\rho_i^{*,n+1} = \rho_i^n + \Delta t\left[-\nabla\cdot(\rho_i\vb)^n + \nabla\cdot\Fb^n\right].
\end{equation}
\item {\bf Step 1d:} Compute preliminary time-advanced enthalpy by iteratively looping over an energy solve.
The fundamental formulation is given by,
\begin{eqnarray}
\frac{(\rho h)^{*,n+1} - (\rho h)^n}{\Delta t} &=& -\nabla\cdot(\rho h\vb)^n + \frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n}\nonumber\\
&&+ \half\nabla\cdot\Qb^n + \half\nabla\cdot\Qb^{*,n+1}\nonumber\\
&&+ \half\sum_k\nabla\cdot h_k^n\Fb_k^n + \half\sum_k\nabla\cdot h_k^{*,n+1}\Fb_k^{*,n+1}\nonumber\\
&&+ \half(\rho\Hext)^n + \half(\rho\Hext)^{*,n+1},
\end{eqnarray}
but since we express $\Qb$ in terms of temperature gradients, we need an iterative
solve that linearizes the dependence of $h$ on $T$.  First we initialize
$(h,T)^{*,n+1,l=1} = (h,T)^n$.
Loop from $l=1$ to $l_{\rm max}$:\\ \\
{\bf Step 1d-1:} Define
\begin{equation}
(\lambda,c_p,\Fb)^{*,n+1,l} = \lambda,c_P,\Fb(\rho^{*,n+1},\wb^{*,n+1},T^{*,n+1,l}).
\end{equation}
{\bf Step 1d-2:} Solve for $\delta T$ implicitly:
\begin{eqnarray}
\frac{\rho^{*,n+1}(h^{*,n+1,l} + c_p^{*,n+1,l}\delta T) - (\rho h)^n}{\Delta t} &=&
-\nabla\cdot(\rho h\vb)^n + \frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n} \nonumber\\
&&\hspace{-1in} + \half\nabla\cdot\lambda^n\nabla T^n + \half\nabla\cdot\lambda^{*,n+1,l}\nabla(T^{*,n+1,l} + \delta T)\nonumber\\
&&\hspace{-1in} + \half\sum_k\nabla\cdot h_k^n \Fb_k^n + \half\sum_k\nabla\cdot h_k^{*,n+1,l} \Fb_k^{*,n+1,l},\nonumber\\
&&\hspace{-1in} + \half(\rho\Hext)^n + \half(\rho\Hext)^{*,n+1}
\end{eqnarray}
\begin{eqnarray}
\left(\frac{\rho^{*,n+1}c_p^{*,n+1,l}}{\Delta t} - \nabla\cdot\frac{1}{2}\lambda^{*,n+1,l}\nabla\right)\delta T &=& \frac{(\rho h)^n - \rho^{*,n+1}h^{*,n+1,l}}{\Delta t}\nonumber\\
&&\hspace{-1.25in} - \nabla\cdot(\rho h\vb)^n + \frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n}\nonumber\\
&&\hspace{-1.25in} + \half\nabla\cdot\lambda^n\nabla T^n + \half\nabla\cdot\lambda^{*,n+1,l}\nabla T^{*,n+1,l}\nonumber\\
&&\hspace{-1.25in} + \half\sum_k\nabla\cdot h_k^n \Fb_k^n + \half\sum_k\nabla\cdot h_k^{*,n+1,l} \Fb_k^{*,n+1,l},\nonumber\\
&&\hspace{-1.25in} + \half(\rho\Hext)^n + \half(\rho\Hext)^{*,n+1}.
\end{eqnarray}

{\bf Step 1d-3:} Update the temperature and enthalpy using
\begin{equation}
T^{*,n+1,l+1} = T^{*,n+1,l} + \delta T, \quad h^{*,n+1,l+1} = h(\wb^{*,n+1},T^{*,n+1,l+1}).
\end{equation}
If $l=l_{\rm max}$, set $(h,T)^{*,n+1} = (h,T)^{*,n+1,l+1}$ and proceed to {\bf Step 1e}.\\
\item {\bf Step 1e:} Compute the thermodynamic drift, $P_{\rm EOS}^{*,n+1} - P_0^{*,n+1}$.
If the drift is acceptable, proceed to {\bf Step 2}.  Otherwise,
update the volume discrepancy correction,
\begin{equation}
S_{\rm corr}^n = S_{\rm corr}^n + \alpha^{*,n+1}\left(\frac{P_{\rm EOS}^{*,n+1} - P_0^{*,n+1}}{\Delta t}\right),
\end{equation}
split this into average and perturbational components.
and return to {\bf Step 1a}.\\
\end{itemize}

{\bf Step 2: Scalar Corrector}.\\ \\
The goal of this step is to compute updated time-advanced densities and enthalpy 
that are consistent with $P_0$.  This will require the computation
of a velocity field, $\vb^{*,n+1}$, that preserves this thermodynamic balance.
We compute $(S,\alpha)^{*,n+1}$ and decompose them
into average and perturbational components.
We set the volume discrepancy correction to the value
$S_{\rm corr}^{*,n+1} = S_{\rm corr}^n$ and compute its decomposition.
We loop over the following until the convergence criteria in {\bf Step 2e} is met:\\
\begin{itemize}
\item {\bf Step 2a:} Compute a pressure update:
\begin{equation}
P_0^{n+1} = P_0^n + \frac{\Delta t}{2}\left(\frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n}\right) + \frac{\Delta t}{2}\left(\frac{\bar{S}^{*,n+1} + \bar{S}_{\rm corr}^{*,n+1}}{\bar{\alpha}^{*,n+1}}\right).
\end{equation}
\item {\bf Step 2b:} Compute the velocity and the dynamic pressure using a GMRES solver for the Stokes system:
\begin{equation}
\frac{\rho^{*,n+1}\vb^{*,n+1} - \rho^n\vb^n}{\Delta t} + \nabla\pi^{*,n+1} = -\nabla\cdot(\rho\vb\vb)^n + \frac{1}{2}\nabla\cdot(\taub^n + \taub^{*,n+1}) + \frac{1}{2}(\rho^n + \rho^{*,n+1})\gb,
\end{equation}
\begin{equation}
\nabla\cdot\vb^{*,n+1} = \delta S^{*,n+1} + \delta S_{\rm corr}^{*,n+1} - \delta\alpha^{*,n+1}\left(\frac{\bar{S}^{*,n+1} + \bar{S}_{\rm corr}^{*,n+1}}{\bar{\alpha}^{*,n+1}}\right).
\end{equation}
\MarginPar{More notes for implementation that do not need to go into paper.}
We recast the Stokes system using $\vb^{*,n+1} = \bar{\vb}^n + \deltab\vb, \pi^{*,n+1} = \pi^n + \delta\pi$
(see explanation in {\bf Step 1b}):
\begin{eqnarray}
\left(\frac{\rho^{*,n+1}}{\Delta t} - \half\mathcal{A}_0^{*,n+1}\right)\deltab\vb + \nabla\delta\pi &=& \frac{\rho^n\vb^n - \rho^{*,n+1}\bar{\vb}^n}{\Delta t} - \nabla\pi^n\nonumber\\
&&\hspace{-1in}- \nabla\cdot(\rho\vb\vb)^n + \half(\mathcal{A}_0^n\vb^n+\mathcal{A}_0^{*,n+1}\bar{\vb}^n) + \half(\rho^n + \rho^{*,n+1})\gb,\nonumber\\
\end{eqnarray}
\begin{equation}
-\nabla\cdot\delta\vb = \nabla\cdot\bar{\vb}^n - \left[\delta S^{*,n+1} + \delta S_{\rm corr}^{*,n+1} - \delta\alpha^{*,n+1}\left(\frac{\bar{S}^{*,n+1} + \bar{S}_{\rm corr}^{*,n+1}}{\bar{\alpha}^{*,n+1}}\right)\right].
\end{equation}
\item {\bf Step 2c:} Compute time-advanced densities using trapezoidal advective and diffusive fluxes:
\begin{equation}
\rho_i^{n+1} = \rho_i^n + \frac{\Delta t}{2}\left[-\nabla\cdot(\rho_i\vb)^n -\nabla\cdot(\rho_i\vb)^{*,n+1} + \nabla\cdot\Fb^n + \nabla\cdot\Fb^{*,n+1}\right].
\end{equation}
\item {\bf Step 2d:} Compute time-advanced enthalpy by iteratively looping over an energy solve.
The fundamental formulation is given by,
\begin{eqnarray}
\frac{(\rho h)^{n+1} - (\rho h)^n}{\Delta t} &=& \half\left[-\nabla\cdot(\rho h\vb)^n -\nabla\cdot(\rho h\vb)^{*,n+1} + \frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n} + \frac{\bar{S}^{*,n+1}+ \bar{S}_{\rm corr}^{*,n+1}}{\bar{\alpha}^{*,n+1}}\right]\nonumber\\
&&+ \half\nabla\cdot\Qb^n + \half\nabla\cdot\Qb^{n+1}\nonumber\\
&&+ \half\sum_k\nabla\cdot h_k^n\Fb_k^n + \half\sum_k\nabla\cdot h_k^{n+1}\Fb_k^{n+1}\nonumber\\
&&+ \half(\rho\Hext)^n + \half(\rho\Hext)^{n+1},
\end{eqnarray}
but since we express $\Qb$ in terms of temperature gradients, we need an iterative solve that linearizes
the dependence of $h$ on $T$.  First we initialize $(h,T)^{n+1,l=1} = (h,T)^{*,n+1}$.
Loop from $l=1$ to $l_{\rm max}$:\\ \\
{\bf Step 2d-1:} Define
\begin{equation}
(\lambda,c_p,\Fb)^{n+1,l} = \lambda,c_p,\Fb(\rho^{n+1},\wb^{n+1},T^{n+1,l}).
\end{equation}
{\bf Step 2d-2:} Solve for $\delta T$ implicitly:
\begin{eqnarray}
\frac{\rho^{n+1}(h^{n+1,l} + c_p^{n+1,l}\delta T) - (\rho h)^n}{\Delta t} &=& \nonumber\\
&&\hspace{-1in}\half\left[-\nabla\cdot(\rho h\vb)^n - \nabla\cdot(\rho h\vb)^{*,n+1} + \frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n} + \frac{\bar{S}^{*,n+1}+ \bar{S}_{\rm corr}^{*,n+1}}{\bar{\alpha}^{*,n+1}}\right] \nonumber\\
&&\hspace{-1in} + \half\nabla\cdot\lambda^n\nabla T^n + \half\nabla\cdot\lambda^{n+1,l}\nabla(T^{n+1,l} + \delta T)\nonumber\\
&&\hspace{-1in} + \half\sum_k\nabla\cdot h_k^n \Fb_k^n + \half\sum_k\nabla\cdot h_k^{n+1,l} \Fb_k^{n+1,l}\nonumber\\
&&\hspace{-1in} + \half(\rho\Hext)^n + \half(\rho\Hext)^{n+1},
\end{eqnarray}
\begin{eqnarray}
\left(\frac{\rho^{n+1}c_p^{n+1,l}}{\Delta t} - \nabla\cdot\frac{1}{2}\lambda^{n+1,l}\nabla\right)\delta T &=& \frac{(\rho h)^n - \rho^{n+1}h^{n+1,l}}{\Delta t}\nonumber\\
&&\hspace{-1.25in} + \half\left[-\nabla\cdot(\rho h\vb)^n - \nabla\cdot(\rho h\vb)^{*,n+1} + \frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n} + \frac{\bar{S}^{*,n+1} + \bar{S}_{\rm corr}^{*,n+1}}{\bar{\alpha}^{*,n+1}}\right]\nonumber\\
&&\hspace{-1.25in} + \half\nabla\cdot\lambda^n\nabla T^n + \half\nabla\cdot\lambda^{n+1,l}\nabla T^{n+1,l}\nonumber\\
&&\hspace{-1.25in} + \half\sum_k\nabla\cdot h_k^n \Fb_k^n + \half\sum_k\nabla\cdot h_k^{n+1,l} \Fb_k^{n+1,l}\nonumber\\
&&\hspace{-1.25in} + \half(\rho\Hext)^n + \half(\rho\Hext)^{n+1}.
\end{eqnarray}
{\bf Step 2d-3:} Update the temperature and enthalpy using
\begin{equation}
T^{n+1,l+1} = T^{n+1,l} + \delta T, \quad h^{n+1,l+1} = h(\wb^{n+1},T^{n+1,l+1}).
\end{equation}
If $l=l_{\rm max}$, set $(h,T)^{n+1} = (h,T)^{n+1,l+1}$ and proceed to {\bf Step 2e}.\\
\item {\bf Step 2e:} Compute the thermodynamic drift, $P_{\rm EOS}^{n+1} - P_0^{n+1}$.
If the drift is acceptable, return to {\bf Step 1}.  Otherwise,
update the volume discrepancy correction,
\begin{equation}
S_{\rm corr}^{*,n+1} = S_{\rm corr}^{*,n+1} + 2\alpha^{n+1}\left(\frac{P_{\rm EOS}^{n+1} - P_0^{n+1}}{\Delta t}\right),
\end{equation}
split this into average and perturbational components, and return to {\bf Step 2a}.
Note there is a factor of two scaling the drift, since the advective term
only carries a half-weighting due to the trapezoidal temporal integration.\\
\end{itemize}

{\bf Step 0: Initialization}.\\ \\
At the beginning of the simulation, we replace {\bf Step 1} with this initialization step.
This step is only performed once at the beginning of the simulation, so here $n=0$.
Note that this step is essentially the same as
{\bf Step 1}, except that in the computation of $\vb^n$ we use a projection rather
than a Stokes solver.
I suggest we specify $\rho,\wb$, and $P_0$, compute $\rho_i = \rho w_i$,
and then use the EOS to compute a consistent
$T$ and $h$.  The velocity can be initialized to zero, noting that the
initialization step will dictate what the velocity must be for the system to stay
on the constraint.
The goal of this step is to compute preliminary time-advanced densities and enthalpy
that are consistent with $P_0$.  This will
require the computation of a velocity field, $\vb^n$, that preserves this
thermodynamic balance.
We compute $(S,\alpha)^n$ and decompose them
into average and perturbational components.
We set the initial volume discrepancy correction to zero, 
$S_{\rm corr}^n = 0$, as well as the individual terms in the decomposition,
$S_{\rm corr}^n = \bar{S}_{\rm corr}^n + \delta S_{\rm corr}^n$.
We loop over the following until the convergence criteria in {\bf Step 0e} is met:\\
\begin{itemize}
\item {\bf Step 0a:} Same as {\bf Step 1a}.
\item {\bf Step 0b:} Compute the velocity field using
\begin{equation}
\nabla\cdot\vb^n = \delta S^n + \delta S_{\rm corr}^n - \delta\alpha^n\left(\frac{\bar{S}^n + \bar{S}_{\rm corr}^n}{\bar{\alpha}^n}\right) \equiv S_{\rm proj}.
\end{equation}
This involves solving the ellptic equation,
\begin{equation}
\nabla\cdot\frac{1}{\rho}\nabla\Phi = \nabla\cdot\vb^n - S_{\rm proj},
\end{equation}
and velocity update,
\begin{equation}
\vb^n = \vb^n - \frac{1}{\rho}\nabla\Phi.
\end{equation}

\item {\bf Step 0c:} Same as {\bf Step 1c}.
\item {\bf Step 0d:} Same as {\bf Step 1d}.
\item {\bf Step 0e:} Same as {\bf Step 1e}, except that the loop returns to {\bf Step 0a}.
\end{itemize}


\section{Noble Gas Test Problem}

The EOS we will test is an ideal mixture of four noble gases, 
He, Ne, Ar, and Kr.
The molecular weights, diameters, and assumption of hard sphere dynamics
 are all that is needed to specify the thermodynamics in
{\tt energy\_EOS\_module\_HS.f90}.  The functions of interest are:\\
\begin{itemize}

\item {\tt CKCPBS} computes $c_p(\wb,T)$.  In this EOS this is not dependent on temperature.\\

\item {\tt CKCVBS} computes $c_v(\wb,T)$.  In this EOS this is not dependent on temperature.\\

\item {\tt CKUBMS} computes the mean internal energy, $e(\wb,T)$.\\

\item {\tt get\_t\_given\_ey} computes $T(e,\wb)$.\\

\item {\tt CKPY} computes $P(\rho,\wb,T)$.\\

\item {\tt CKHMS} computes $h_m(T)$.  Note $h = \sum_k w_k h_k$.\\

\item {\tt CKYTX} computes mole fractions, $\xb$, from mass fractions, $\wb$.\\

\item {\tt CKYTCR} computes molar concentrations from $\rho,T$ and $\wb$.
In this EOS this is not dependent on temperature.\\

\item {\tt CKXTY} mass fractions, $\wb$, from mole fractions, $\xb$.\\

\item {\tt CKMMWY} computes the mixture-averaged molecular mass, $\bar{m}$, given $\wb$.\\

\item {\tt CKRHOY} computes $\rho(P,\wb,T)$.\\

\item {\tt CKCPMS} computes the individual specific heats for each component,
$c_p(T)$.  In this EOS this is not dependent on temperature.\\

\end{itemize}

The subroutine {\tt ideal\_mixture\_transport} takes $\rho,T,P,\wb$, and $\xb$ 
as inputs and computes the following:\\
\begin{itemize}

\item {\tt eta} is the dynamic viscosity, $\eta$.\\

\item {\tt zeta} is the bulk viscosity, $\kappa$.\\

\item {\tt diff\_ij} is the diffusion matrix, $\chi$.\\

\item {\tt kappa} is the thermal conductivity, $\lambda$.\\

\item {\tt chitil} are the thermodiffusion coefficients, $\zeta$.
                   (I modified the routine to make this so).\\

\end{itemize}

\section{Conclusions}

Our staggered grid formulation allows for the including of thermal fluctuations
in a way that satisfies discrete fluctuation-dissipation balance through an
exact projection as well as matching stochastic and diffusive operators.
The inclusion of thermal fluctuations is straightforward, following in our previous work.
We defer the inclusion of fluctuations to a future paper, as
the methodology here is applicable to low Mach number models regardless of framework.

\bibliographystyle{unsrt}
\bibliography{DesignDocument}

\end{document}
