\documentclass[final]{siamltex}

% for red MarginPars
\usepackage{color}

% for \boldsymbol
\usepackage{amsmath}
\usepackage{latexsym}
\usepackage{graphicx}
\usepackage{geometry}
\usepackage{hyperref}

% total number of floats allowed on a page
\setcounter{totalnumber}{100}

% MarginPar
\setlength{\marginparwidth}{0.75in}
\newcommand{\MarginPar}[1]{\marginpar{\vskip-\baselineskip\raggedright\tiny\sffamily\hrule\smallskip{\color{red}#1}\par\smallskip\hrule}}

% for non-stacked fractions
\newcommand{\sfrac}[2]{\mathchoice
  {\kern0em\raise.5ex\hbox{\the\scriptfont0 #1}\kern-.15em/
   \kern-.15em\lower.25ex\hbox{\the\scriptfont0 #2}}
  {\kern0em\raise.5ex\hbox{\the\scriptfont0 #1}\kern-.15em/
   \kern-.15em\lower.25ex\hbox{\the\scriptfont0 #2}}
  {\kern0em\raise.5ex\hbox{\the\scriptscriptfont0 #1}\kern-.2em/
   \kern-.15em\lower.25ex\hbox{\the\scriptscriptfont0 #2}}
  {#1\!/#2}}

\def\Ab {{\bf A}}
\def\bb {{\bf b}}
\def\Fb {{\bf F}}
\def\gb {{\bf g}}
\def\vb {{\bf v}}
\def\Wb {{\bf W}}
\def\xb {{\bf x}}

\def\Psib {\boldsymbol{\Psi}}
\def\taub {\boldsymbol{\tau}}
\def\Sigmab {\boldsymbol{\Sigma}}

\def\half   {\frac{1}{2}}
\def\myhalf {\sfrac{1}{2}}

\begin{document}

%==========================================================================
% Title
%==========================================================================
\title{Implicit Low Mach Number Binary Mixing Notes}

\maketitle

\section{Equations}
We have two incompressible fluids with densities $\bar\rho_1$ and $\bar\rho_2$, where 
each fluid does not change volume upon mixing.  Defining $\rho$ to be the density of
a mixture of these fluids, the densities of each fluid are $\rho_1 \equiv \rho c$ and 
$\rho_2 \equiv \rho(1-c)$, where $c$ is the {\it mass} fraction of the first fluid.  
Thus, $\rho = \rho_1 + \rho_2$.  Since the fluids do not change volume upon mixing, 
the equation of state will enforce that the {\it volume} fractions must sum to 1:
\begin{equation}
\frac{\rho_1}{\bar\rho_1} + \frac{\rho_2}{\bar\rho_2} =
\frac{\rho c}{\bar\rho_1} + \frac{\rho(1-c)}{\bar\rho_2} = 1 
\quad \rightarrow \quad
\rho = \left(\frac{c}{\bar\rho_1} + \frac{1-c}{\bar\rho_2}\right)^{-1}.
\end{equation}
The isothermal low Mach number equations of motion are:
\begin{eqnarray}
\partial_t\rho &=& -\nabla\cdot(\rho\vb),\\
\partial_t\rho_1 &=& -\nabla\cdot(\rho_1\vb) + \underbrace{\nabla\cdot\rho\chi\nabla c + \nabla\cdot\Psib}_{\nabla\cdot\Fb},\\
\partial_t(\rho\vb) &=& -\nabla\cdot(\rho\vb\vb^T) - \nabla\pi + \nabla\cdot\taub + \nabla\cdot\Sigmab + \rho\gb,
\end{eqnarray}
subject to
\begin{equation}
\nabla\cdot\vb = S \equiv \left(\frac{1}{\bar\rho_1}-\frac{1}{\bar\rho_2}\right)\nabla\cdot\Fb.
\end{equation}
Thus, $S \equiv S(\Fb)$.  The stochastic terms are:
\begin{eqnarray}
\Psib &=& \sqrt{\frac{2\chi\rho\mu_c^{-1}k_BT}{\Delta t\Delta V}}\widetilde\Wb,\\
\Sigmab &=& \sqrt{\frac{\eta k_B T}{\Delta t\Delta V}}\left(\Wb + \Wb^T\right),
\end{eqnarray}
where $\Wb$ and $\widetilde\Wb$ are standard white-noise random Gaussian tensor
and vector fields with uncorrelated components

\section{GMRES Solver}
We also have a standalone GMRES solver of the form,
\begin{equation}
\underbrace{
\left(\begin{array}{cc}
\mathcal{A} & \mathcal{G} \\
-\mathcal{D} & 0
\end{array}\right)
}_{\Ab}
\underbrace{
\left(\begin{array}{c}
\xb_{\vb} \\
x_p
\end{array}\right)
}_{\xb}
=
\underbrace{
\left(\begin{array}{c}
\bb_{\vb}\\
b_p
\end{array}\right)}_{\bb},
\end{equation}
where $\xb_\vb$ and $\bb_\vb$ are staggered quantities and $x_p$ and $b_p$ are
cell-centered quantities.  The gradient operator, $\mathcal{G}$, operates on
cell-centered data and returns a staggered field.  The divergence operator, 
$\mathcal{D}$, operates on staggered data and returns a cell-centered field.  
The Helmholtz-like operator, $\mathcal{A}$, has the general form,
$\mathcal{A} = \Theta\alpha\mathcal{I} - \mathcal{A}_0$, where
$\Theta$ is a constant parameter,
$\alpha$ is a cell-centered quantity,
$\mathcal{I}$ is the identity matrix, 
and $\mathcal{A}_0$ represents the viscous stress tensor.
Both $\mathcal{A}$ and $\mathcal{A}_0$ operate on staggered data and return
a staggered field.\\

The code has several options for the viscous stress tensor.  For ease of exposition,
we define $\mathcal{A}_0$ as a function of a velocity vector, $\vb$:\\
\begin{itemize}
\item $|${\tt visc\_type}$|$=1 $\quad\rightarrow\quad \mathcal{A}_0(\vb) = \nabla\cdot\beta\nabla\vb$.\\
\item $|${\tt visc\_type}$|$=2 $\quad\rightarrow\quad \mathcal{A}_0(\vb) = \nabla\cdot\left\{\beta[\nabla\vb + (\nabla\vb)^T]\right\}$.\\
\item $|${\tt visc\_type}$|$=3 $\quad\rightarrow\quad \mathcal{A}_0(\vb) = \nabla\cdot\left\{\beta[\nabla\vb + (\nabla\vb)^T] + \mathcal{I}\left(\gamma - \frac{2}{3}\beta\right)(\nabla\cdot\vb)\right\}$.\\
\end{itemize}

\section{Algorithm}
Here is the time-advancement scheme.\\ \\
{\bf Step 0: Initialization:}\\

If this is the beginning of the simulation, we perform a projection to obtain an initial 
velocity field, $\vb^0$, that satisfies
\begin{equation}
\nabla\cdot\vb^0 = S^0.
\end{equation}
We do this by solving for $\phi$ and updating $\vb^{\rm init}$ as follows:
\begin{equation}
\nabla\cdot\frac{1}{\rho}\nabla\phi = \nabla\cdot\vb^{\rm init} - S^0,
\end{equation}
\begin{equation}
\vb^0 = \vb^{\rm init} - \frac{1}{\rho}\nabla\phi.
\end{equation}
{\bf Step 1: Forward Euler Scalar Predictor:}
\begin{eqnarray}
\rho^{*,n+1} &=& \rho^n + \Delta t\nabla\cdot(-\rho^n\vb^n),\\
\rho_1^{*,n+1} &=& \rho_1^n + \Delta t\nabla\cdot(-\rho_1^n\vb^n + \Fb^n),
\end{eqnarray}
with
\begin{equation}
\Fb^n = (\rho\chi\nabla c)^n + \sqrt{\frac{2(\chi\rho\mu_c^{-1})^nk_BT}{\Delta t\Delta V}}\widetilde\Wb^n.
\end{equation}
{\bf Step 2: Crank-Nicolson Velocity Predictor:}\\ \\
First, define
\begin{equation}
S^{*,n+1} \equiv S(\Fb^{*,n+1});
\qquad
\Fb^{*,n+1} = (\rho\chi\nabla c)^{*,n+1} + \sqrt{\frac{2(\chi\rho\mu_c^{-1})^{*,n+1}k_BT}{\Delta t\Delta V}}\widetilde\Wb^n.
\end{equation}
Then, solve the following for $\vb^{*,n+1}$:
\begin{eqnarray}
\frac{\rho^{*,n+1}\vb^{*,n+1} - \rho^n\vb^n}{\Delta t} + \nabla\pi &=& \nabla\cdot(-\rho^n\vb^n\vb^n)\nonumber\\
&&\hspace{-0.5in}+ \half(\nabla\cdot\taub^n + \nabla\cdot\taub^{*,n+1}) + \nabla\cdot\sqrt{\frac{\eta^{*,n+\myhalf} k_B T}{\Delta t\Delta V}}\left[\Wb^n + (\Wb^n)^T\right],\label{eq:CN Vel Pred}
\end{eqnarray}
\begin{equation}
\nabla\cdot\vb^{*,n+1} = S^{*,n+1}.
\end{equation}
We rewrite (\ref{eq:CN Vel Pred}) as
\begin{eqnarray}
\left(\rho^{*,n+1} - \frac{\Delta t}{2}\nabla\cdot\taub\right)\vb^{*,n+1} + \Delta t\nabla\pi &=& \rho^n\vb^n\nonumber\\
&&\hspace{-1.5in}+ \Delta t\left\{\nabla\cdot(-\rho^n\vb^n\vb^n) + \half\nabla\cdot\taub^n + \nabla\cdot\sqrt{\frac{\eta^n k_B T}{\Delta t\Delta V}}\left[\Wb^n + (\Wb^n)^T\right]\right\}.\label{eq:CN Vel Pred2}
\end{eqnarray}
Relating this to the GMRES solver, we can see that we are solving for 
$(\xb_\vb,x_p) = (\vb^{*,n+1},\Delta t\cdot\pi)$ with $b_p = -S^{*,n+1}$ and $\bb_\vb$ equal to the 
right-hand-side of (\ref{eq:CN Vel Pred2}).  For the Helmholtz-like operator, 
$\mathcal{A}=\Theta\alpha\mathcal{I} - \mathcal{A}_0$, we have $\Theta=1$, $\alpha=\rho^{*,n+1}$,
and $\mathcal{A}_0$ representing the viscous operator $\taub$, noting that the coefficients
$\beta$ and $\gamma$ need to be multiplied by $\Delta t/2$.  We actually do not care about
the result $x_p$ so we essentially throw it away after the GMRES solve.\\ \\
{\bf Step 3: Trapezoidal Scalar Corrector:}
\begin{eqnarray}
\rho^{n+1} &=& \half\rho^n + \half\left[\rho^{*,n+1} + \Delta t\nabla\cdot(-\rho^{*,n+1}\vb^{*,n+1})\right],\\
\rho_1^{n+1} &=& \half\rho_1^n + \half\left[\rho_1^{*,n+1} + \Delta t\nabla\cdot(-\rho_1^{*,n+1}\vb^{*,n+1} + \Fb^{*,n+1})\right].
\end{eqnarray}
{\bf Step 4: Crank-Nicolson Velocity Corrector:}\\ \\
First, define
\begin{equation}
S^{n+1} \equiv S(\Fb^{n+1});
\qquad
\Fb^{n+1} = (\rho\chi\nabla c)^{n+1} + \sqrt{\frac{2(\chi\rho\mu_c^{-1})^{n+1}k_BT}{\Delta t\Delta V}}\widetilde\Wb^{*,n+1}.
\end{equation}
Note the use of time-advanced stochastic concentration fluxes.
Finally, solve the following for $\vb^{n+1}$.
We're not really sure how to deal with the random fluxes, so for now we will use 
the same value as in the predictor.
\begin{eqnarray}
\frac{\rho^{n+1}\vb^{n+1} - \rho^n\vb^n}{\Delta t} + \nabla\pi &=& \half\nabla\cdot(-\rho^n\vb^n\vb^n - \rho^{n+1}\vb^{n+1}\vb^{n+1})\nonumber\\
&&\hspace{-0.5in}+ \half(\nabla\cdot\taub^n + \nabla\cdot\taub^{n+1}) + \nabla\cdot\sqrt{\frac{\eta^{n+\myhalf} k_B T}{\Delta t\Delta V}}\left[\Wb^n + (\Wb^n)^T\right],\label{eq:CN Vel Corr}
\end{eqnarray}
\begin{equation}
\nabla\cdot\vb^{n+1} = S^{n+1}.
\end{equation}
We rewrite (\ref{eq:CN Vel Corr}) as
\begin{eqnarray}
\left(\rho^{n+1} - \frac{\Delta t}{2}\nabla\cdot\taub\right)\vb^{n+1} + \Delta t\nabla\pi &=& \rho^n\vb^n\nonumber\\
&&\hspace{-1.75in}+ \Delta t\left\{\half\nabla\cdot(-\rho^n\vb^n\vb^n-\rho^{n+1}\vb^{n+1}\vb^{n+1}) + \half\nabla\cdot\taub^n + \nabla\cdot\sqrt{\frac{\eta^n k_B T}{\Delta t\Delta V}}\left[\Wb^n + (\Wb^n)^T\right]\right\}.\nonumber\\
\end{eqnarray}
\end{document}
